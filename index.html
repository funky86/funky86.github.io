<!DOCTYPE html>
<html lang="en">
  <head>
    <title>EV Home Charging Cost Calculator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script type="importmap">
        {
          "imports": {
            "@popperjs/core": "https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js",
            "bootstrap": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/+esm"
          }
        }
    </script>
  </head>

  <body>
    <div id="app" class="container">
      <h1>EV Home Charging Cost Calculator</h1>

      <form v-on:submit.prevent="calculate">

        <input type="text" class="form-control" id="carsDropdown" placeholder="Star typing car brand and model ..." autocomplete="off">

        <div class="btn-group mb-3" role="group">
          <input type="radio" class="btn-check" name="conditions" id="conditionCity" autocomplete="off">
          <label class="btn btn-primary" for="conditionCity">City</label>

          <input type="radio" class="btn-check" name="conditions" id="conditionHighway" autocomplete="off">
          <label class="btn btn-primary" for="conditionHighway">Highway</label>

          <input type="radio" class="btn-check" name="conditions" id="conditionCombined" autocomplete="off" checked>
          <label class="btn btn-primary" for="conditionCombined">Combined</label>
        </div>

        <br>
        
        <div class="btn-group mb-3" role="group">
          <input type="radio" class="btn-check" name="weather" id="weatherMild" autocomplete="off" checked>
          <label class="btn btn-primary" for="weatherMild">Mild weather</label>

          <input type="radio" class="btn-check" name="weather" id="weatherCold" autocomplete="off">
          <label class="btn btn-primary" for="weatherCold">Cold weather</label>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2">
            <label for="consumption" class="col-form-label">Consumption:</label>
          </div>
          <div class="col">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Choose a car or enter value" id="consumption" v-model.number="consumption">
              <span class="input-group-text">Wh/km</span>
            </div>
          </div>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2">
            <label for="electricityPrice" class="col-form-label">Electricity price:</label>
          </div>
          <div class="col">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Price per kW/h from your electricity bill" id="electricityPrice" v-model.number="electricityPrice">
              <span class="input-group-text">€</span>
            </div>
          </div>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2">
            <label for="distance" class="col-form-label">Distance:</label>
          </div>
          <div class="col">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Enter distance" id="distance" v-model.number="distance">
              <span class="input-group-text">km</span>
            </div>
          </div>
        </div>

        <p>Result: {{ result }} €</p>
        <button type="submit" class="btn btn-primary">Calculate</button>
      </form>
    </div>

    <script type="module">
      const app = Vue.createApp({
        data() {
          return {
            consumption: null,
            electricityPrice: null,
            distance: null,
            result: 0
          }
        },
        methods: {
          calculate() {
            this.result = (this.consumption*0.001 * this.distance * this.electricityPrice).toFixed(2);
          },
          setFormData(consumption) {
            this.consumption = consumption;
          }
        }
      });
      const vm = app.mount('#app');

      import * as bootstrap from 'bootstrap'

      const DEFAULTS = {
      threshold: 2,
      maximumItems: 5,
      highlightTyped: true,
      highlightClass: 'text-primary',
      label: 'label',
      value: 'value',
      showValue: false,
      showValueBeforeLabel: false,
      };

      class Autocomplete {
      constructor(field, options) {
          this.field = field;
          this.options = Object.assign({}, DEFAULTS, options);
          this.dropdown = null;

          field.parentNode.classList.add('dropdown');
          field.setAttribute('data-bs-toggle', 'dropdown');
          field.classList.add('dropdown-toggle');

          const dropdown = ce(`<div class="dropdown-menu"></div>`);
          if (this.options.dropdownClass)
          dropdown.classList.add(this.options.dropdownClass);

          insertAfter(dropdown, field);

          this.dropdown = new bootstrap.Dropdown(field, this.options.dropdownOptions);

          field.addEventListener('click', (e) => {
          if (this.createItems() === 0) {
              e.stopPropagation();
              this.dropdown.hide();
          }
          });

          field.addEventListener('input', () => {
          if (this.options.onInput)
              this.options.onInput(this.field.value);
          this.renderIfNeeded();
          });

          field.addEventListener('keydown', (e) => {
          if (e.keyCode === 27) {
              this.dropdown.hide();
              return;
          }
          if (e.keyCode === 40) {
              this.dropdown._menu.children[0]?.focus();
              return;
          }
          });
      }

      setData(data) {
          this.options.data = data;
          this.renderIfNeeded();
      }

      renderIfNeeded() {
          if (this.createItems() > 0)
          this.dropdown.show();
          else
          this.field.click();
      }

      createItem(lookup, item) {
          let label;
          if (this.options.highlightTyped) {
          const idx = removeDiacritics(item.label)
              .toLowerCase()
              .indexOf(removeDiacritics(lookup).toLowerCase());
          const className = Array.isArray(this.options.highlightClass) ? this.options.highlightClass.join(' ')
              : (typeof this.options.highlightClass == 'string' ? this.options.highlightClass : '');
          label = item.label.substring(0, idx)
              + `<span class="${className}">${item.label.substring(idx, idx + lookup.length)}</span>`
              + item.label.substring(idx + lookup.length, item.label.length);
          } else {
          label = item.label;
          }

          if (this.options.showValue) {
          if (this.options.showValueBeforeLabel) {
              label = `${item.value} ${label}`;
          } else {
              label += ` ${item.value}`;
          }
          }

          return ce(`<button type="button" class="dropdown-item" data-label="${item.label}" data-value="${item.value}">${label}</button>`);
      }

      createItems() {
          const lookup = this.field.value;
          if (lookup.length < this.options.threshold) {
          this.dropdown.hide();
          return 0;
          }

          const items = this.field.nextSibling;
          items.innerHTML = '';

          const keys = Object.keys(this.options.data);

          let count = 0;
          for (let i = 0; i < keys.length; i++) {
          const key = keys[i];
          const entry = this.options.data[key];
          const item = {
              label: this.options.label ? entry[this.options.label] : key,
              value: this.options.value ? entry[this.options.value] : entry
          };

          if (removeDiacritics(item.label).toLowerCase().indexOf(removeDiacritics(lookup).toLowerCase()) >= 0) {
              items.appendChild(this.createItem(lookup, item));
              if (this.options.maximumItems > 0 && ++count >= this.options.maximumItems)
              break;
          }
          }

          this.field.nextSibling.querySelectorAll('.dropdown-item').forEach((item) => {
          item.addEventListener('click', (e) => {
              let dataLabel = e.currentTarget.getAttribute('data-label');
              let dataValue = e.currentTarget.getAttribute('data-value');

              this.field.value = dataLabel;

              if (this.options.onSelectItem) {
              this.options.onSelectItem({
                  value: dataValue,
                  label: dataLabel
              });
              }

              this.dropdown.hide();
          })
          });

          return items.childNodes.length;
      }
      }

      /**
       * @param html
       * @returns {Node}
       */
      function ce(html) {
      let div = document.createElement('div');
      div.innerHTML = html;
      return div.firstChild;
      }

      /**
       * @param elem
       * @param refElem
       * @returns {*}
       */
      function insertAfter(elem, refElem) {
      return refElem.parentNode.insertBefore(elem, refElem.nextSibling);
      }

      /**
       * @param {String} str
       * @returns {String}
       */
      function removeDiacritics(str) {
      return str
          .normalize('NFD')
          .replace(/[\u0300-\u036f]/g, '');
      }

      export { Autocomplete };

      var carsDataDropdown = []; var carsData = []; var cdi = -1;
      carsDataDropdown[++cdi] = { "label": "Tesla Model 3", "value": cdi };
      carsData[cdi] = { "usableBattery": 57.5, "realRange": 415, "consumption": 139 };

      const carsDropdownField = document.getElementById('carsDropdown');
      const ac = new Autocomplete(carsDropdownField, {
          data: [{label: "I'm a label", value: 42}],
          maximumItems: 5,
          threshold: 1,
          onSelectItem: ({label, value}) => {
              vm.setFormData(carsData[value].consumption);
          }
      });

      ac.setData(carsDataDropdown);
    </script>
  </body>
</html>